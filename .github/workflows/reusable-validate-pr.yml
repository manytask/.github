name: "Validate PR"

on:
  workflow_call:



jobs:
  validate_pr_title:
    name: Check PR title uses Conventional Commits
    runs-on: ubuntu-latest
    steps:
      - uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  validate_pr_labels:
    name: Check Conventional Commits labels
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v8
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(l => l.name);
            const requiredLabels = [
              'breaking',
              'feature',
              'fix',
              'chore',
              'test',
              'ci',
              'enhancement',
              'refactor',
              'performance',
              'style',
              'documentation',
              'dependencies'
            ];
            
            const hasRequiredLabel = labels.some(label => requiredLabels.includes(label));
            
            if (!hasRequiredLabel) {
              core.setFailed(
                `PR must have at least one of the following labels: ${requiredLabels.join(', ')}\n` +
                `Current labels: ${labels.length > 0 ? labels.join(', ') : 'none'}`
              );
            } else {
              core.info(`âœ… PR has valid label(s): ${labels.filter(l => requiredLabels.includes(l)).join(', ')}`);
            }
